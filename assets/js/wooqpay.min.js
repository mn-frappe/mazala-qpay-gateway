/**
 * WooQPay Frontend JavaScript (Minified)
 * @package WooQPay
 * @version 1.0.0
 */
!function(t){"use strict";var o={init:function(){this.bindEvents(),this.initQRModal(),this.initPaymentPolling()},bindEvents:function(){t(document).on("click",".wooqpay-qr-expand",this.expandQR),t(document).on("click",".wooqpay-modal-close",this.closeModal),t(document).on("click",".wooqpay-modal-overlay",this.closeModal),t(document).on("click",".wooqpay-copy-deeplink",this.copyDeeplink),t(document).on("click",".wooqpay-bank-link",this.handleBankLink),t(document).on("keydown",this.handleKeydown)},initQRModal:function(){0===t(".wooqpay-qr-modal").length&&t("body").append('<div class="wooqpay-modal-overlay" style="display:none;"><div class="wooqpay-qr-modal"><button class="wooqpay-modal-close">&times;</button><div class="wooqpay-modal-content"></div></div></div>')},expandQR:function(o){o.preventDefault();var e=t(this).closest(".wooqpay-qr-container").find(".wooqpay-qr-image");if(e.length){var a=e.attr("src");t(".wooqpay-modal-content").html('<img src="'+a+'" alt="QR Code" style="max-width:100%;height:auto;">'),t(".wooqpay-modal-overlay").fadeIn(200)}},closeModal:function(o){(t(o.target).hasClass("wooqpay-modal-overlay")||t(o.target).hasClass("wooqpay-modal-close"))&&t(".wooqpay-modal-overlay").fadeOut(200)},handleKeydown:function(o){"Escape"===o.key&&t(".wooqpay-modal-overlay").is(":visible")&&t(".wooqpay-modal-overlay").fadeOut(200)},copyDeeplink:function(e){e.preventDefault();var a=t(this),n=a.data("link")||a.attr("href");navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(n).then(function(){o.showCopySuccess(a)}).catch(function(){o.fallbackCopy(n,a)}):o.fallbackCopy(n,a)},fallbackCopy:function(e,a){var n=t("<input>");t("body").append(n),n.val(e).select(),document.execCommand("copy"),n.remove(),o.showCopySuccess(a)},showCopySuccess:function(t){var o=t.text();t.text(wooqpay_params.i18n.copied||"Copied!"),setTimeout(function(){t.text(o)},2e3)},handleBankLink:function(e){var a=t(this),n=a.data("deeplink"),i=a.data("fallback");n&&o.isMobile()&&(e.preventDefault(),window.location.href=n,i&&setTimeout(function(){document.hidden||(window.location.href=i)},2e3))},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},initPaymentPolling:function(){var o=t(".wooqpay-payment-pending");if(0!==o.length){var e=o.data("order-id"),a=o.data("invoice-id"),n=o.data("check-url"),i=parseInt(o.data("poll-interval"))||5e3,s=parseInt(o.data("max-attempts"))||60,r=0;if(e&&n){var c=setInterval(function(){++r>s?clearInterval(c):t.ajax({url:n,type:"POST",data:{action:"wooqpay_check_payment",order_id:e,invoice_id:a,nonce:wooqpay_params.nonce},success:function(t){t.success&&t.data.paid?(clearInterval(c),WooQPay.handlePaymentSuccess(t.data)):t.data&&t.data.cancelled&&(clearInterval(c),WooQPay.handlePaymentCancelled())},error:function(){}})},i)}}},handlePaymentSuccess:function(o){t(".wooqpay-payment-pending").addClass("wooqpay-payment-success"),t(".wooqpay-status-message").html('<div class="wooqpay-success"><span class="wooqpay-success-icon">âœ“</span> '+(wooqpay_params.i18n.payment_success||"Payment successful!")+"</div>"),o.redirect_url&&setTimeout(function(){window.location.href=o.redirect_url},2e3)},handlePaymentCancelled:function(){t(".wooqpay-payment-pending").addClass("wooqpay-payment-cancelled"),t(".wooqpay-status-message").html('<div class="wooqpay-error">'+(wooqpay_params.i18n.payment_cancelled||"Payment was cancelled.")+"</div>")},showPaymentTimeout:function(){t(".wooqpay-status-message").html('<div class="wooqpay-warning">'+(wooqpay_params.i18n.payment_timeout||"Payment check timed out. Please refresh the page.")+"</div>")},formatAmount:function(t,o){return new Intl.NumberFormat("mn-MN",{style:"currency",currency:o||"MNT",minimumFractionDigits:0}).format(t)}};t(document).ready(function(){o.init()}),window.WooQPay=o}(jQuery);
